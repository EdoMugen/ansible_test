---
- name: Install latest Node.js (NodeSource) on Ubuntu
  hosts: all          # or a specific group like "ubuntu_servers"
  become: yes
  gather_facts: yes

  tasks:
    - name: Run only on Debian/Ubuntu families
      ansible.builtin.assert:
        that: ansible_os_family == "Debian"
        fail_msg: "This playbook only supports Debian/Ubuntu."
        success_msg: "Debian/Ubuntu detected."

    - name: Ensure required packages are installed
      ansible.builtin.apt:
        name:
          - curl
          - ca-certificates
        state: present
        update_cache: yes

    - name: Add NodeSource repo (Node 20 LTS)
      ansible.builtin.shell: |
        curl -fsSL https://deb.nodesource.com/setup_20.x | bash -
      args:
        executable: /bin/bash

    - name: Install Node.js
      ansible.builtin.apt:
        name: nodejs
        state: present
        update_cache: yes